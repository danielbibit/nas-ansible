---
- name: Install Restic
  ansible.builtin.package:
    name: restic
    state: present

- name: Check if restic repo is init
  ansible.builtin.stat:
    path: /etc/ansible_backups/immich_restic
  register: restic_init

- name: Initialize Restic repository
  ansible.builtin.command:
    cmd: >
      export AWS_ACCESS_KEY_ID={{ backup_immich_b2_account_id }}
      export AWS_SECRET_ACCESS_KEY={{ backup_immich_b2_account_key }}
      export RESTIC_REPOSITORY=
      export RESTIC_PASSWORD_FILE=
      restic init
  when: not restic_init.stat.exists

- name: Install borgbackup
  ansible.builtin.package:
    name: borgbackup
    state: present
